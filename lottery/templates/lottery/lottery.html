{% extends "base.html" %}

{% block content %}
<div class="body-container">
    <h2>Senior Week Event Bidding</h2>
    <div class="intro">
        We're looking forward to celebrating Senior Week together! 
        Round 1 bidding is open until <i>May 9th 11:59pm</i>.
        <b>Feel free to resubmit as many times as you'd like, we will use your most recent submission.</b>
        <br/>
        <br/>
        For complete information on the events and the bidding process, please visit <a href="https://engage.mit.edu/2025swc/home/">https://engage.mit.edu/2025swc/home/</a>.
    </div>
    {% if error_message %}<p style="color:red"><strong>{{ error_message }}</strong></p>{% endif %}
    {% if submit_message %}<p style="color:green"><strong>{{ submit_message }}</strong></p>{% endif %}
    
    <hr/>
    <br/>

    <div>
        As part of the bidding process, please list the number of points you'd like to bid on each event. You may bid up to 1000 points total. 
    </div>

    <form action="{% url 'lottery_submit' %}" method="post">
        {% csrf_token %}
        {% for event in events_list %}
            {% if event.biddable %}
                <div class="event">
                    <label for="{{ event.name }}">{{ event.name }}</label>
                    <div class="event-info"> 
                            <i>{{ event.date }} {% if event.time %} {{ event.time }} {% endif %}</i>
                            {% if event.location %} <div>{{ event.location }} </div> {% endif %}
                            {% if event.price %} <div>Price: ${{  event.price }} </div> {% endif %}
                            {% if event.capacity %} <div>Capacity: {{  event.capacity }} </div> {% endif %}
                            {% if event.extra_info %} <div>{{  event.extra_info }} </div> {% endif %}
                    </div>
                    <input type="number" name="{{ event.name }}" id="{{ event.name }}" class="lottery-input" min="0" max="1000" placeholder=""/>
                </div>
            {% endif %}
        {% endfor %}

        <div class="remaining-points" style="display: flex;">
            <label for="points-total-value" id="points-total-label">Remaining Points: </label>
            <span id="points-total-value" style="margin-left: 5px;">1000</span>
        </div>

        <hr/>
        <br/>

        <div>
            The following events are all FREE - JUST SHOW UP! For planning purposes, though, feel free to let us know if you're planning on attending.
            {% for event in events_list %}
                {% if not event.biddable %}
                    <div class="event">
                        <label for="{{ event.name }}">{{ event.name }}</label>
                        <div class="event-info"> 
                                <i>{{ event.date }} {% if event.time %} {{ event.time }} {% endif %}</i>
                                {% if event.location %} <div>{{ event.location }} </div> {% endif %}
                                {% if event.price %} <div>Price: ${{  event.price }} </div> {% endif %}
                                {% if event.capacity %} <div>Capacity: {{  event.capacity }} </div> {% endif %}
                                {% if event.extra_info %} <div>{{  event.extra_info }} </div> {% endif %}
                        </div>
                        <div class="event-attendance">
                            <label for="{{ event.name }}-yes"><input type="radio" id="{{ event.name }}-yes" name="{{ event.name }}" value="yes">Yes</label>
                            <label for="{{ event.name }}-no"><input type="radio" id="{{ event.name }}-no" name="{{ event.name }}" value="no">No</label>
                            <label for="{{ event.name }}-maybe"><input type="radio" id="{{ event.name }}-maybe" name="{{ event.name }}" value="maybe">Maybe</label>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <input type="submit" value="Submit" />
    </form>
</div>

<script>
function updateSum() {
    let sum = 0;
    document.querySelectorAll('.lottery-input').forEach(input => {
        sum += Number(input.value) || 0;
    });

    const totalValueElement = document.getElementById('points-total-value');
    const totalLabelElement = document.getElementById('points-total-label');
    totalValueElement.textContent = 1000 - sum;
    if (sum > 1000) {
      totalValueElement.style.color = 'red';
      totalLabelElement.style.color = 'red';
    } else {
        totalValueElement.style.color = 'black';
        totalLabelElement.style.color = 'black';
    }
}
document.querySelectorAll('.lottery-input').forEach(input => {
    input.addEventListener('input', updateSum);
});
</script>
{% endblock %}
